\
# PRODUCT_SPEC.md

## 1) Коротко: что это
Локальное приложение для игры в стиле ЛитРПГ по локальной сети, объединяющее двух пользователей в пару:

- **Система (Host / GM)** — редактирует мир и данные, управляет сообщениями и контентом.
- **Игрок (Client)** — получает красивый интерфейс “журнала/панелей” и может выполнять разрешённые действия.

Архитектура: один хост-сервер + два веб-интерфейса (Host UI и Player UI), синхронизация через события.

---

## 2) Основные цели
1) Быстро и удобно вести игру: выдавать квесты, лут, опыт, эффекты, сообщения.
2) Чёткое разделение прав: Система правит, Игрок просматривает и взаимодействует только в рамках разрешений.
3) Красивый, но лёгкий интерфейс: “журнал”, воздушные панели, отдельное окно системных сообщений.
4) Надёжная синхронизация: ничего не теряется, всё логируется, можно экспортировать и переносить.

---

## 3) Сеть и сессии
### 3.1 Пара “Система + Игрок”
- Система создаёт сессию.
- Игрок подключается по LAN (IP:порт + PIN).
- После подключения Игрок получает:
  - актуальный снимок состояния
  - подписку на поток событий

### 3.2 Восстановление
- При разрыве связи Игрок должен уметь переподключиться и “догнать” события.

---

## 4) Права доступа
### 4.1 Система (Host)
Может:
- создавать/редактировать/удалять: классы, способности, категории способностей, предметы, шаблоны, квесты, сообщения, НПС-профили, валюты/репутации/шкалы/ресурсы
- менять правила (XP-кривая, начисление очков, ограничения классов, доступность действий)
- отправлять игроку контент из библиотеки заготовок
- включать/выключать “заморозку” действий игрока

### 4.2 Игрок (Client)
Может:
- просматривать лист персонажа, инвентарь, экипировку, способности, квесты, логи, чат
- выполнять разрешённые действия:
  - экипировать/снять предметы
  - использовать предметы (как действие или как запрос — определяется настройками)
  - выбирать варианты в сообщениях
  - распределять очки характеристик (если не заморожено)
- НЕ может напрямую:
  - добавлять/удалять предметы
  - изменять статы/правила/описания/квесты

---

## 5) Лист персонажа (настраивается системой)
### 5.1 Общая идея
Лист — это набор секций/вкладок. Система настраивает:
- какие секции существуют
- порядок, названия, подсказки
- видимость полей (видно игроку/скрыто)

### 5.2 Обязательные элементы
- Профиль: имя, класс, уровень (титулы опционально)
- XP шкала (текущий XP / XP до следующего)
- Очки характеристик “доступно”
- Характеристики (настраиваемый список)
- Ресурсы (HP/MP/выносливость и т.п., настраиваемые шкалы)
- Валюты (настраиваемые)
- Репутации (настраиваемые)
- Экипировка (фиксированные слоты)
- Способности (с категориями-источниками)

---

## 6) XP-кривая (выбрана экспоненциальная)
Опыт до следующего уровня:

`xp_to_next(level) = round(base_xp * (growth_rate ** (level-1)))`

Параметры:
- `base_xp` (например 200)
- `growth_rate` (например 1.25)

Требования:
- Система может менять `base_xp` и `growth_rate` из UI
- настройки сохраняются и входят в экспорт

---

## 7) Автоначисление очков характеристик за уровень (фиксированное правило)
При получении уровня `L` (то есть переходе на уровень L):
- +5 всегда
- +2 если L кратен 5
- +1 если L кратен 10 (дополнительно, поверх +2)

Очки отображаются в профиле: “Доступно очков”.

Игрок распределяет очки сам (если действия не заморожены).

Система должна иметь:
- кнопку “Повысить уровень”
- кнопку “Повысить уровень ×N” (массово)
- при массовом повышении — серия сообщений игроку (уровень, очки, изменения)

---

## 8) Классы и ограничения
### 8.1 Ограничения класса
Система задаёт:
- какие типы предметов можно экипировать
- какие слоты доступны/запрещены (если нужно)
- какие категории способностей доступны/видимы

### 8.2 Классовые награды по уровням (X|Y|Z → выбранные характеристики)
Для каждого класса Система настраивает “пер-левел” добавки к характеристикам:
- пример: за уровень +X к “Ф”, +Y к “В”, +Z к “С”
- механизм должен быть расширяемым: N характеристик, разные значения

Требования:
- настройка из UI
- применяется автоматически на левелап
- фиксируется в логах

---

## 9) Способности
### 9.1 Вкладка способностей у игрока
- Способности разделены по категориям-источникам (создаются системой).
- Категории могут быть скрыты/показаны.

### 9.2 Управление системой
Система может:
- добавить/удалить способность
- отключить (неактивна)
- скрыть
- заморозить все способности разом

Источники способностей:
- класс
- экипировка
- эффекты/благословения/проклятия
(источники настраиваемые)

---

## 10) Инвентарь и экипировка
### 10.1 Инвентарь
- список предметов
- сортировка (минимум: по редкости, типу, имени, новизне)
- карточка предмета: описание, свойства, редкость, бонусы, источник

### 10.2 Слоты экипировки (фиксировано)
- `weapon_1`, `weapon_2` (двуручное занимает оба)
- `head`, `torso`, `legs`, `boots`
- `ring_1`, `ring_2`

### 10.3 Бонусы экипировки
Надетые предметы могут:
- давать бонусы к статам
- добавлять способности (в категории источника “Экипировка” или указанной)

---

## 11) Редкости предметов и цветовая градация (фиксировано)
Цвета:
- серый
- белый
- зелёный
- синий
- фиолетовый
- оранжевый
- красный

Иконки опциональны.

---

## 12) Квесты
### 12.1 Основные свойства
- название, описание, цели, награды, статус
- флаг “нельзя отказаться”
- цели: чек-лист и/или прогресс

### 12.2 Дублирование квестов
Запрещено отправлять игроку одинаковый квест второй раз, если первый ещё не зачтён/не завершён/не провален.

---

## 13) Системные сообщения
### 13.1 Типы
- уведомления (toast)
- глобальные уведомления
- сообщения лога
- окна квеста/лута/уровня/выбора

### 13.2 Сворачивание
- большинство сообщений можно сворачивать (включая выборы)
- некоторые нельзя (флаг)
- выбор: до выбора — полное окно; после выбора — частичное сворачивание с отображением выбранного варианта
- сообщения сохраняются в истории

### 13.3 Звуки (3 типа)
- info / warning / alert
- уровень (lev-up) имеет особый эффект (может использовать alert звук или отдельный)

---

## 14) Авто-логи
При большинстве действий должны появляться записи в логах:
- выдача/удаление предмета
- экипировка/снятие
- выдача квеста/смена статуса/зачёт
- выдача XP/левелап
- изменение валют/репутаций/ресурсов/статов
- заморозка/разморозка

---

## 15) Библиотека заготовок у Системы
Система хранит заготовки:
- сообщений (включая повторяющиеся)
- предметов/шаблонов предметов
- квестов/шаблонов квестов
- пресетов НПС/игроков (для линков в чат)

Должно быть удобно “взять и отправить” игроку (перетаскивание или кнопка отправки).

Должны действовать ограничения на дублирование (как минимум для квестов).

---

## 16) Чат и друзья (мессенджер)
- Чат открывается после “принятия заявки в друзья”.
- Заявки отправляет только Система.
- Система может писать “за других игроков/НПС”.
- В чатах возможны линки (карточки):
  - имя/класс/уровень/HP для пресета НПС/игрока
  - квест/лут (карточка описания)
- Игрок переписывается в формате мессенджера.

---

## 17) Экспорт/импорт
Всё сохраняется и экспортируется:
- правила/настройки
- лист персонажа
- библиотека заготовок
- квесты, предметы, способности, категории
- чаты (опционально)
- логи/события (опционально)

Экспорт: JSON (+ ассеты отдельно, если есть).

